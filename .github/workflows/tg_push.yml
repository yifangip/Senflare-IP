name: Telegram Push Senflare IP

on:
  workflow_dispatch:   # æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: "0 */9 * * *"   # æ¯9å°æ—¶è¿è¡Œä¸€æ¬¡

jobs:
  push_to_tg:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout ä»“åº“
        uses: actions/checkout@v4

      - name: ä¸‹è½½æœ€æ–°æ–‡ä»¶
        run: |
          curl -L -o Senflare-Pro.txt https://raw.githubusercontent.com/yifangip/Senflare-IP/refs/heads/main/Senflare-Pro.txt

      - name: ç”Ÿæˆæ—¶é—´æˆ³æ–‡ä»¶åå’Œç»Ÿè®¡IPæ•°é‡å¹¶æ¨é€ Telegram
        run: |
          # æ—¶é—´æˆ³æ–‡ä»¶åï¼ˆåŒ—äº¬æ—¶é—´ UTC+8ï¼‰
          TIME_STR=$(date -d "+8 hour" '+%Y-%m-%d_%H-%M')
          READABLE_TIME=$(date -d "+8 hour" '+%Y-%m-%d %H:%M')
          NEW_NAME="${TIME_STR}_ä¼˜é€‰ip.txt"
          mv Senflare-Pro.txt "$NEW_NAME"

          # ç»Ÿè®¡ IP æ•°é‡
          IP_COUNT=$(wc -l < "$NEW_NAME" | tr -d ' ')

          # Telegram æ¨é€ï¼ˆå•è¡Œ caption é¿å… YAML æŠ¥é”™ï¼‰
          curl -F document=@"$NEW_NAME" \
               -F caption="
               ğŸ“¦ ä¼˜é€‰IPæ›´æ–°é€šçŸ¥ 
               ğŸ•“ æ›´æ–°æ—¶é—´ï¼š$READABLE_TIME 
               ğŸ“Š IPæ•°é‡ï¼š$IP_COUNT ä¸ª 
               ğŸ§¾ æ–‡ä»¶åï¼š$NEW_NAME" \
               "https://api.telegram.org/bot${{ secrets.TG_BOT_TOKEN }}/sendDocument?chat_id=${{ secrets.TG_CHAT_ID }}"

          echo "æ–‡ä»¶å·²æ¨é€ Telegram: $NEW_NAME"
